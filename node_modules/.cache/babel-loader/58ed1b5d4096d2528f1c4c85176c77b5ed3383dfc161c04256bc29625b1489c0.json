{"ast":null,"code":"// MSSQL Client\n// -------\nconst map = require('lodash/map');\nconst isNil = require('lodash/isNil');\nconst Client = require('../../client');\nconst MSSQL_Formatter = require('./mssql-formatter');\nconst Transaction = require('./transaction');\nconst QueryCompiler = require('./query/mssql-querycompiler');\nconst SchemaCompiler = require('./schema/mssql-compiler');\nconst TableCompiler = require('./schema/mssql-tablecompiler');\nconst ViewCompiler = require('./schema/mssql-viewcompiler');\nconst ColumnCompiler = require('./schema/mssql-columncompiler');\nconst QueryBuilder = require('../../query/querybuilder');\nconst debug = require('debug')('knex:mssql');\nconst SQL_INT4 = {\n  MIN: -2147483648,\n  MAX: 2147483647\n};\nconst SQL_BIGINT_SAFE = {\n  MIN: -9007199254740991,\n  MAX: 9007199254740991\n};\n\n// Always initialize with the \"QueryBuilder\" and \"QueryCompiler\" objects, which\n// extend the base 'lib/query/builder' and 'lib/query/compiler', respectively.\nclass Client_MSSQL extends Client {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(config);\n  }\n\n  /**\n   * @param {import('knex').Config} options\n   */\n  _generateConnection() {\n    const settings = this.connectionSettings;\n    settings.options = settings.options || {};\n\n    /** @type {import('tedious').ConnectionConfig} */\n    const cfg = {\n      authentication: {\n        type: settings.type || 'default',\n        options: {\n          userName: settings.userName || settings.user,\n          password: settings.password,\n          domain: settings.domain,\n          token: settings.token,\n          clientId: settings.clientId,\n          clientSecret: settings.clientSecret,\n          tenantId: settings.tenantId,\n          msiEndpoint: settings.msiEndpoint\n        }\n      },\n      server: settings.server || settings.host,\n      options: {\n        database: settings.database,\n        encrypt: settings.encrypt || false,\n        port: settings.port || 1433,\n        connectTimeout: settings.connectionTimeout || settings.timeout || 15000,\n        requestTimeout: !isNil(settings.requestTimeout) ? settings.requestTimeout : 15000,\n        rowCollectionOnDone: false,\n        rowCollectionOnRequestCompletion: false,\n        useColumnNames: false,\n        tdsVersion: settings.options.tdsVersion || '7_4',\n        appName: settings.options.appName || 'knex',\n        trustServerCertificate: false,\n        ...settings.options\n      }\n    };\n\n    // tedious always connect via tcp when port is specified\n    if (cfg.options.instanceName) delete cfg.options.port;\n    if (isNaN(cfg.options.requestTimeout)) cfg.options.requestTimeout = 15000;\n    if (cfg.options.requestTimeout === Infinity) cfg.options.requestTimeout = 0;\n    if (cfg.options.requestTimeout < 0) cfg.options.requestTimeout = 0;\n    if (settings.debug) {\n      cfg.options.debug = {\n        packet: true,\n        token: true,\n        data: true,\n        payload: true\n      };\n    }\n    return cfg;\n  }\n  _driver() {\n    const tds = require('tedious');\n    return tds;\n  }\n  formatter() {\n    return new MSSQL_Formatter(this, ...arguments);\n  }\n  transaction() {\n    return new Transaction(this, ...arguments);\n  }\n  queryCompiler() {\n    return new QueryCompiler(this, ...arguments);\n  }\n  schemaCompiler() {\n    return new SchemaCompiler(this, ...arguments);\n  }\n  tableCompiler() {\n    return new TableCompiler(this, ...arguments);\n  }\n  viewCompiler() {\n    return new ViewCompiler(this, ...arguments);\n  }\n  queryBuilder() {\n    const b = new QueryBuilder(this);\n    return b;\n  }\n  columnCompiler() {\n    return new ColumnCompiler(this, ...arguments);\n  }\n  wrapIdentifierImpl(value) {\n    if (value === '*') {\n      return '*';\n    }\n    return `[${value.replace(/[[\\]]+/g, '')}]`;\n  }\n\n  // Get a raw connection, called by the `pool` whenever a new\n  // connection needs to be added to the pool.\n  acquireRawConnection() {\n    return new Promise((resolver, rejecter) => {\n      debug('connection::connection new connection requested');\n      const Driver = this._driver();\n      const settings = Object.assign({}, this._generateConnection());\n      const connection = new Driver.Connection(settings);\n      connection.connect(err => {\n        if (err) {\n          debug('connection::connect error: %s', err.message);\n          return rejecter(err);\n        }\n        debug('connection::connect connected to server');\n        connection.connected = true;\n        connection.on('error', e => {\n          debug('connection::error message=%s', e.message);\n          connection.__knex__disposed = e;\n          connection.connected = false;\n        });\n        connection.once('end', () => {\n          connection.connected = false;\n          connection.__knex__disposed = 'Connection to server was terminated.';\n          debug('connection::end connection ended.');\n        });\n        return resolver(connection);\n      });\n    });\n  }\n  validateConnection(connection) {\n    return connection && connection.connected;\n  }\n\n  // Used to explicitly close a connection, called internally by the pool\n  // when a connection times out or the pool is shutdown.\n  destroyRawConnection(connection) {\n    debug('connection::destroy');\n    return new Promise(resolve => {\n      connection.once('end', () => {\n        resolve();\n      });\n      connection.close();\n    });\n  }\n\n  // Position the bindings for the query.\n  positionBindings(sql) {\n    let questionCount = -1;\n    return sql.replace(/\\\\?\\?/g, match => {\n      if (match === '\\\\?') {\n        return '?';\n      }\n      questionCount += 1;\n      return `@p${questionCount}`;\n    });\n  }\n  _chomp(connection) {\n    if (connection.state.name === 'LoggedIn') {\n      const nextRequest = this.requestQueue.pop();\n      if (nextRequest) {\n        debug('connection::query executing query, %d more in queue', this.requestQueue.length);\n        connection.execSql(nextRequest);\n      }\n    }\n  }\n  _enqueueRequest(request, connection) {\n    this.requestQueue.push(request);\n    this._chomp(connection);\n  }\n  _makeRequest(query, callback) {\n    const Driver = this._driver();\n    const sql = typeof query === 'string' ? query : query.sql;\n    let rowCount = 0;\n    if (!sql) throw new Error('The query is empty');\n    debug('request::request sql=%s', sql);\n    const request = new Driver.Request(sql, (err, remoteRowCount) => {\n      if (err) {\n        debug('request::error message=%s', err.message);\n        return callback(err);\n      }\n      rowCount = remoteRowCount;\n      debug('request::callback rowCount=%d', rowCount);\n    });\n    request.on('prepared', () => {\n      debug('request %s::request prepared', this.id);\n    });\n    request.on('done', (rowCount, more) => {\n      debug('request::done rowCount=%d more=%s', rowCount, more);\n    });\n    request.on('doneProc', (rowCount, more) => {\n      debug('request::doneProc id=%s rowCount=%d more=%s', request.id, rowCount, more);\n    });\n    request.on('doneInProc', (rowCount, more) => {\n      debug('request::doneInProc id=%s rowCount=%d more=%s', request.id, rowCount, more);\n    });\n    request.once('requestCompleted', () => {\n      debug('request::completed id=%s', request.id);\n      return callback(null, rowCount);\n    });\n    request.on('error', err => {\n      debug('request::error id=%s message=%s', request.id, err.message);\n      return callback(err);\n    });\n    return request;\n  }\n\n  // Grab a connection, run the query via the MSSQL streaming interface,\n  // and pass that through to the stream we've sent back to the client.\n  _stream(connection, query, /** @type {NodeJS.ReadWriteStream} */stream) {\n    return new Promise((resolve, reject) => {\n      const request = this._makeRequest(query, err => {\n        if (err) {\n          stream.emit('error', err);\n          return reject(err);\n        }\n        resolve();\n      });\n      request.on('row', row => {\n        stream.write(row.reduce((prev, curr) => ({\n          ...prev,\n          [curr.metadata.colName]: curr.value\n        }), {}));\n      });\n      request.on('error', err => {\n        stream.emit('error', err);\n        reject(err);\n      });\n      request.once('requestCompleted', () => {\n        stream.end();\n        resolve();\n      });\n      this._assignBindings(request, query.bindings);\n      this._enqueueRequest(request, connection);\n    });\n  }\n  _assignBindings(request, bindings) {\n    if (Array.isArray(bindings)) {\n      for (let i = 0; i < bindings.length; i++) {\n        const binding = bindings[i];\n        this._setReqInput(request, i, binding);\n      }\n    }\n  }\n  _scaleForBinding(binding) {\n    if (binding % 1 === 0) {\n      throw new Error(`The binding value ${binding} must be a decimal number.`);\n    }\n    return {\n      scale: 10\n    };\n  }\n  _typeForBinding(binding) {\n    const Driver = this._driver();\n    if (this.connectionSettings.options && this.connectionSettings.options.mapBinding) {\n      const result = this.connectionSettings.options.mapBinding(binding);\n      if (result) {\n        return [result.value, result.type];\n      }\n    }\n    switch (typeof binding) {\n      case 'string':\n        return [binding, Driver.TYPES.NVarChar];\n      case 'boolean':\n        return [binding, Driver.TYPES.Bit];\n      case 'number':\n        {\n          if (binding % 1 !== 0) {\n            return [binding, Driver.TYPES.Float];\n          }\n          if (binding < SQL_INT4.MIN || binding > SQL_INT4.MAX) {\n            if (binding < SQL_BIGINT_SAFE.MIN || binding > SQL_BIGINT_SAFE.MAX) {\n              throw new Error(`Bigint must be safe integer or must be passed as string, saw ${binding}`);\n            }\n            return [binding, Driver.TYPES.BigInt];\n          }\n          return [binding, Driver.TYPES.Int];\n        }\n      default:\n        {\n          if (binding instanceof Date) {\n            return [binding, Driver.TYPES.DateTime];\n          }\n          if (binding instanceof Buffer) {\n            return [binding, Driver.TYPES.VarBinary];\n          }\n          return [binding, Driver.TYPES.NVarChar];\n        }\n    }\n  }\n\n  // Runs the query on the specified connection, providing the bindings\n  // and any other necessary prep work.\n  _query(connection, query) {\n    return new Promise((resolve, reject) => {\n      const rows = [];\n      const request = this._makeRequest(query, (err, count) => {\n        if (err) {\n          return reject(err);\n        }\n        query.response = rows;\n        process.nextTick(() => this._chomp(connection));\n        resolve(query);\n      });\n      request.on('row', row => {\n        debug('request::row');\n        rows.push(row);\n      });\n      this._assignBindings(request, query.bindings);\n      this._enqueueRequest(request, connection);\n    });\n  }\n\n  // sets a request input parameter. Detects bigints and decimals and sets type appropriately.\n  _setReqInput(req, i, inputBinding) {\n    const [binding, tediousType] = this._typeForBinding(inputBinding);\n    const bindingName = 'p'.concat(i);\n    let options;\n    if (typeof binding === 'number' && binding % 1 !== 0) {\n      options = this._scaleForBinding(binding);\n    }\n    debug('request::binding pos=%d type=%s value=%s', i, tediousType.name, binding);\n    if (Buffer.isBuffer(binding)) {\n      options = {\n        length: 'max'\n      };\n    }\n    req.addParameter(bindingName, tediousType, binding, options);\n  }\n\n  // Process the response as returned from the query.\n  processResponse(query, runner) {\n    if (query == null) return;\n    let {\n      response\n    } = query;\n    const {\n      method\n    } = query;\n    if (query.output) {\n      return query.output.call(runner, response);\n    }\n    response = response.map(row => row.reduce((columns, r) => {\n      const colName = r.metadata.colName;\n      if (columns[colName]) {\n        if (!Array.isArray(columns[colName])) {\n          columns[colName] = [columns[colName]];\n        }\n        columns[colName].push(r.value);\n      } else {\n        columns[colName] = r.value;\n      }\n      return columns;\n    }, {}));\n    if (query.output) return query.output.call(runner, response);\n    switch (method) {\n      case 'select':\n        return response;\n      case 'first':\n        return response[0];\n      case 'pluck':\n        return map(response, query.pluck);\n      case 'insert':\n      case 'del':\n      case 'update':\n      case 'counter':\n        if (query.returning) {\n          if (query.returning === '@@rowcount') {\n            return response[0][''];\n          }\n        }\n        return response;\n      default:\n        return response;\n    }\n  }\n}\nObject.assign(Client_MSSQL.prototype, {\n  requestQueue: [],\n  dialect: 'mssql',\n  driverName: 'mssql'\n});\nmodule.exports = Client_MSSQL;","map":{"version":3,"names":["map","require","isNil","Client","MSSQL_Formatter","Transaction","QueryCompiler","SchemaCompiler","TableCompiler","ViewCompiler","ColumnCompiler","QueryBuilder","debug","SQL_INT4","MIN","MAX","SQL_BIGINT_SAFE","Client_MSSQL","constructor","config","arguments","length","undefined","_generateConnection","settings","connectionSettings","options","cfg","authentication","type","userName","user","password","domain","token","clientId","clientSecret","tenantId","msiEndpoint","server","host","database","encrypt","port","connectTimeout","connectionTimeout","timeout","requestTimeout","rowCollectionOnDone","rowCollectionOnRequestCompletion","useColumnNames","tdsVersion","appName","trustServerCertificate","instanceName","isNaN","Infinity","packet","data","payload","_driver","tds","formatter","transaction","queryCompiler","schemaCompiler","tableCompiler","viewCompiler","queryBuilder","b","columnCompiler","wrapIdentifierImpl","value","replace","acquireRawConnection","Promise","resolver","rejecter","Driver","Object","assign","connection","Connection","connect","err","message","connected","on","e","__knex__disposed","once","validateConnection","destroyRawConnection","resolve","close","positionBindings","sql","questionCount","match","_chomp","state","name","nextRequest","requestQueue","pop","execSql","_enqueueRequest","request","push","_makeRequest","query","callback","rowCount","Error","Request","remoteRowCount","id","more","_stream","stream","reject","emit","row","write","reduce","prev","curr","metadata","colName","end","_assignBindings","bindings","Array","isArray","i","binding","_setReqInput","_scaleForBinding","scale","_typeForBinding","mapBinding","result","TYPES","NVarChar","Bit","Float","BigInt","Int","Date","DateTime","Buffer","VarBinary","_query","rows","count","response","process","nextTick","req","inputBinding","tediousType","bindingName","concat","isBuffer","addParameter","processResponse","runner","method","output","call","columns","r","pluck","returning","prototype","dialect","driverName","module","exports"],"sources":["/Users/user/dig_develop/solo_project/node_modules/knex/lib/dialects/mssql/index.js"],"sourcesContent":["// MSSQL Client\n// -------\nconst map = require('lodash/map');\nconst isNil = require('lodash/isNil');\n\nconst Client = require('../../client');\nconst MSSQL_Formatter = require('./mssql-formatter');\nconst Transaction = require('./transaction');\nconst QueryCompiler = require('./query/mssql-querycompiler');\nconst SchemaCompiler = require('./schema/mssql-compiler');\nconst TableCompiler = require('./schema/mssql-tablecompiler');\nconst ViewCompiler = require('./schema/mssql-viewcompiler');\nconst ColumnCompiler = require('./schema/mssql-columncompiler');\nconst QueryBuilder = require('../../query/querybuilder');\n\nconst debug = require('debug')('knex:mssql');\n\nconst SQL_INT4 = { MIN: -2147483648, MAX: 2147483647 };\nconst SQL_BIGINT_SAFE = { MIN: -9007199254740991, MAX: 9007199254740991 };\n\n// Always initialize with the \"QueryBuilder\" and \"QueryCompiler\" objects, which\n// extend the base 'lib/query/builder' and 'lib/query/compiler', respectively.\nclass Client_MSSQL extends Client {\n  constructor(config = {}) {\n    super(config);\n  }\n\n  /**\n   * @param {import('knex').Config} options\n   */\n  _generateConnection() {\n    const settings = this.connectionSettings;\n    settings.options = settings.options || {};\n\n    /** @type {import('tedious').ConnectionConfig} */\n    const cfg = {\n      authentication: {\n        type: settings.type || 'default',\n        options: {\n          userName: settings.userName || settings.user,\n          password: settings.password,\n          domain: settings.domain,\n          token: settings.token,\n          clientId: settings.clientId,\n          clientSecret: settings.clientSecret,\n          tenantId: settings.tenantId,\n          msiEndpoint: settings.msiEndpoint,\n        },\n      },\n      server: settings.server || settings.host,\n      options: {\n        database: settings.database,\n        encrypt: settings.encrypt || false,\n        port: settings.port || 1433,\n        connectTimeout: settings.connectionTimeout || settings.timeout || 15000,\n        requestTimeout: !isNil(settings.requestTimeout)\n          ? settings.requestTimeout\n          : 15000,\n        rowCollectionOnDone: false,\n        rowCollectionOnRequestCompletion: false,\n        useColumnNames: false,\n        tdsVersion: settings.options.tdsVersion || '7_4',\n        appName: settings.options.appName || 'knex',\n        trustServerCertificate: false,\n        ...settings.options,\n      },\n    };\n\n    // tedious always connect via tcp when port is specified\n    if (cfg.options.instanceName) delete cfg.options.port;\n\n    if (isNaN(cfg.options.requestTimeout)) cfg.options.requestTimeout = 15000;\n    if (cfg.options.requestTimeout === Infinity) cfg.options.requestTimeout = 0;\n    if (cfg.options.requestTimeout < 0) cfg.options.requestTimeout = 0;\n\n    if (settings.debug) {\n      cfg.options.debug = {\n        packet: true,\n        token: true,\n        data: true,\n        payload: true,\n      };\n    }\n\n    return cfg;\n  }\n\n  _driver() {\n    const tds = require('tedious');\n\n    return tds;\n  }\n\n  formatter() {\n    return new MSSQL_Formatter(this, ...arguments);\n  }\n\n  transaction() {\n    return new Transaction(this, ...arguments);\n  }\n\n  queryCompiler() {\n    return new QueryCompiler(this, ...arguments);\n  }\n\n  schemaCompiler() {\n    return new SchemaCompiler(this, ...arguments);\n  }\n\n  tableCompiler() {\n    return new TableCompiler(this, ...arguments);\n  }\n\n  viewCompiler() {\n    return new ViewCompiler(this, ...arguments);\n  }\n  queryBuilder() {\n    const b = new QueryBuilder(this);\n    return b;\n  }\n\n  columnCompiler() {\n    return new ColumnCompiler(this, ...arguments);\n  }\n\n  wrapIdentifierImpl(value) {\n    if (value === '*') {\n      return '*';\n    }\n\n    return `[${value.replace(/[[\\]]+/g, '')}]`;\n  }\n\n  // Get a raw connection, called by the `pool` whenever a new\n  // connection needs to be added to the pool.\n  acquireRawConnection() {\n    return new Promise((resolver, rejecter) => {\n      debug('connection::connection new connection requested');\n      const Driver = this._driver();\n      const settings = Object.assign({}, this._generateConnection());\n\n      const connection = new Driver.Connection(settings);\n\n      connection.connect((err) => {\n        if (err) {\n          debug('connection::connect error: %s', err.message);\n          return rejecter(err);\n        }\n\n        debug('connection::connect connected to server');\n\n        connection.connected = true;\n        connection.on('error', (e) => {\n          debug('connection::error message=%s', e.message);\n          connection.__knex__disposed = e;\n          connection.connected = false;\n        });\n\n        connection.once('end', () => {\n          connection.connected = false;\n          connection.__knex__disposed = 'Connection to server was terminated.';\n          debug('connection::end connection ended.');\n        });\n\n        return resolver(connection);\n      });\n    });\n  }\n\n  validateConnection(connection) {\n    return connection && connection.connected;\n  }\n\n  // Used to explicitly close a connection, called internally by the pool\n  // when a connection times out or the pool is shutdown.\n  destroyRawConnection(connection) {\n    debug('connection::destroy');\n\n    return new Promise((resolve) => {\n      connection.once('end', () => {\n        resolve();\n      });\n\n      connection.close();\n    });\n  }\n\n  // Position the bindings for the query.\n  positionBindings(sql) {\n    let questionCount = -1;\n    return sql.replace(/\\\\?\\?/g, (match) => {\n      if (match === '\\\\?') {\n        return '?';\n      }\n\n      questionCount += 1;\n      return `@p${questionCount}`;\n    });\n  }\n\n  _chomp(connection) {\n    if (connection.state.name === 'LoggedIn') {\n      const nextRequest = this.requestQueue.pop();\n      if (nextRequest) {\n        debug(\n          'connection::query executing query, %d more in queue',\n          this.requestQueue.length\n        );\n\n        connection.execSql(nextRequest);\n      }\n    }\n  }\n\n  _enqueueRequest(request, connection) {\n    this.requestQueue.push(request);\n    this._chomp(connection);\n  }\n\n  _makeRequest(query, callback) {\n    const Driver = this._driver();\n    const sql = typeof query === 'string' ? query : query.sql;\n    let rowCount = 0;\n\n    if (!sql) throw new Error('The query is empty');\n\n    debug('request::request sql=%s', sql);\n\n    const request = new Driver.Request(sql, (err, remoteRowCount) => {\n      if (err) {\n        debug('request::error message=%s', err.message);\n        return callback(err);\n      }\n\n      rowCount = remoteRowCount;\n      debug('request::callback rowCount=%d', rowCount);\n    });\n\n    request.on('prepared', () => {\n      debug('request %s::request prepared', this.id);\n    });\n\n    request.on('done', (rowCount, more) => {\n      debug('request::done rowCount=%d more=%s', rowCount, more);\n    });\n\n    request.on('doneProc', (rowCount, more) => {\n      debug(\n        'request::doneProc id=%s rowCount=%d more=%s',\n        request.id,\n        rowCount,\n        more\n      );\n    });\n\n    request.on('doneInProc', (rowCount, more) => {\n      debug(\n        'request::doneInProc id=%s rowCount=%d more=%s',\n        request.id,\n        rowCount,\n        more\n      );\n    });\n\n    request.once('requestCompleted', () => {\n      debug('request::completed id=%s', request.id);\n      return callback(null, rowCount);\n    });\n\n    request.on('error', (err) => {\n      debug('request::error id=%s message=%s', request.id, err.message);\n      return callback(err);\n    });\n\n    return request;\n  }\n\n  // Grab a connection, run the query via the MSSQL streaming interface,\n  // and pass that through to the stream we've sent back to the client.\n  _stream(connection, query, /** @type {NodeJS.ReadWriteStream} */ stream) {\n    return new Promise((resolve, reject) => {\n      const request = this._makeRequest(query, (err) => {\n        if (err) {\n          stream.emit('error', err);\n          return reject(err);\n        }\n\n        resolve();\n      });\n\n      request.on('row', (row) => {\n        stream.write(\n          row.reduce(\n            (prev, curr) => ({\n              ...prev,\n              [curr.metadata.colName]: curr.value,\n            }),\n            {}\n          )\n        );\n      });\n      request.on('error', (err) => {\n        stream.emit('error', err);\n        reject(err);\n      });\n      request.once('requestCompleted', () => {\n        stream.end();\n        resolve();\n      });\n\n      this._assignBindings(request, query.bindings);\n      this._enqueueRequest(request, connection);\n    });\n  }\n\n  _assignBindings(request, bindings) {\n    if (Array.isArray(bindings)) {\n      for (let i = 0; i < bindings.length; i++) {\n        const binding = bindings[i];\n        this._setReqInput(request, i, binding);\n      }\n    }\n  }\n\n  _scaleForBinding(binding) {\n    if (binding % 1 === 0) {\n      throw new Error(`The binding value ${binding} must be a decimal number.`);\n    }\n\n    return { scale: 10 };\n  }\n\n  _typeForBinding(binding) {\n    const Driver = this._driver();\n\n    if (\n      this.connectionSettings.options &&\n      this.connectionSettings.options.mapBinding\n    ) {\n      const result = this.connectionSettings.options.mapBinding(binding);\n      if (result) {\n        return [result.value, result.type];\n      }\n    }\n\n    switch (typeof binding) {\n      case 'string':\n        return [binding, Driver.TYPES.NVarChar];\n      case 'boolean':\n        return [binding, Driver.TYPES.Bit];\n      case 'number': {\n        if (binding % 1 !== 0) {\n          return [binding, Driver.TYPES.Float];\n        }\n\n        if (binding < SQL_INT4.MIN || binding > SQL_INT4.MAX) {\n          if (binding < SQL_BIGINT_SAFE.MIN || binding > SQL_BIGINT_SAFE.MAX) {\n            throw new Error(\n              `Bigint must be safe integer or must be passed as string, saw ${binding}`\n            );\n          }\n\n          return [binding, Driver.TYPES.BigInt];\n        }\n\n        return [binding, Driver.TYPES.Int];\n      }\n      default: {\n        if (binding instanceof Date) {\n          return [binding, Driver.TYPES.DateTime];\n        }\n\n        if (binding instanceof Buffer) {\n          return [binding, Driver.TYPES.VarBinary];\n        }\n\n        return [binding, Driver.TYPES.NVarChar];\n      }\n    }\n  }\n\n  // Runs the query on the specified connection, providing the bindings\n  // and any other necessary prep work.\n  _query(connection, query) {\n    return new Promise((resolve, reject) => {\n      const rows = [];\n      const request = this._makeRequest(query, (err, count) => {\n        if (err) {\n          return reject(err);\n        }\n\n        query.response = rows;\n\n        process.nextTick(() => this._chomp(connection));\n\n        resolve(query);\n      });\n\n      request.on('row', (row) => {\n        debug('request::row');\n        rows.push(row);\n      });\n\n      this._assignBindings(request, query.bindings);\n      this._enqueueRequest(request, connection);\n    });\n  }\n\n  // sets a request input parameter. Detects bigints and decimals and sets type appropriately.\n  _setReqInput(req, i, inputBinding) {\n    const [binding, tediousType] = this._typeForBinding(inputBinding);\n    const bindingName = 'p'.concat(i);\n    let options;\n\n    if (typeof binding === 'number' && binding % 1 !== 0) {\n      options = this._scaleForBinding(binding);\n    }\n\n    debug(\n      'request::binding pos=%d type=%s value=%s',\n      i,\n      tediousType.name,\n      binding\n    );\n\n    if (Buffer.isBuffer(binding)) {\n      options = {\n        length: 'max',\n      };\n    }\n\n    req.addParameter(bindingName, tediousType, binding, options);\n  }\n\n  // Process the response as returned from the query.\n  processResponse(query, runner) {\n    if (query == null) return;\n    let { response } = query;\n    const { method } = query;\n\n    if (query.output) {\n      return query.output.call(runner, response);\n    }\n\n    response = response.map((row) =>\n      row.reduce((columns, r) => {\n        const colName = r.metadata.colName;\n\n        if (columns[colName]) {\n          if (!Array.isArray(columns[colName])) {\n            columns[colName] = [columns[colName]];\n          }\n\n          columns[colName].push(r.value);\n        } else {\n          columns[colName] = r.value;\n        }\n\n        return columns;\n      }, {})\n    );\n\n    if (query.output) return query.output.call(runner, response);\n    switch (method) {\n      case 'select':\n        return response;\n      case 'first':\n        return response[0];\n      case 'pluck':\n        return map(response, query.pluck);\n      case 'insert':\n      case 'del':\n      case 'update':\n      case 'counter':\n        if (query.returning) {\n          if (query.returning === '@@rowcount') {\n            return response[0][''];\n          }\n        }\n        return response;\n      default:\n        return response;\n    }\n  }\n}\n\nObject.assign(Client_MSSQL.prototype, {\n  requestQueue: [],\n\n  dialect: 'mssql',\n\n  driverName: 'mssql',\n});\n\nmodule.exports = Client_MSSQL;\n"],"mappings":"AAAA;AACA;AACA,MAAMA,GAAG,GAAGC,OAAO,CAAC,YAAY,CAAC;AACjC,MAAMC,KAAK,GAAGD,OAAO,CAAC,cAAc,CAAC;AAErC,MAAME,MAAM,GAAGF,OAAO,CAAC,cAAc,CAAC;AACtC,MAAMG,eAAe,GAAGH,OAAO,CAAC,mBAAmB,CAAC;AACpD,MAAMI,WAAW,GAAGJ,OAAO,CAAC,eAAe,CAAC;AAC5C,MAAMK,aAAa,GAAGL,OAAO,CAAC,6BAA6B,CAAC;AAC5D,MAAMM,cAAc,GAAGN,OAAO,CAAC,yBAAyB,CAAC;AACzD,MAAMO,aAAa,GAAGP,OAAO,CAAC,8BAA8B,CAAC;AAC7D,MAAMQ,YAAY,GAAGR,OAAO,CAAC,6BAA6B,CAAC;AAC3D,MAAMS,cAAc,GAAGT,OAAO,CAAC,+BAA+B,CAAC;AAC/D,MAAMU,YAAY,GAAGV,OAAO,CAAC,0BAA0B,CAAC;AAExD,MAAMW,KAAK,GAAGX,OAAO,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC;AAE5C,MAAMY,QAAQ,GAAG;EAAEC,GAAG,EAAE,CAAC,UAAU;EAAEC,GAAG,EAAE;AAAW,CAAC;AACtD,MAAMC,eAAe,GAAG;EAAEF,GAAG,EAAE,CAAC,gBAAgB;EAAEC,GAAG,EAAE;AAAiB,CAAC;;AAEzE;AACA;AACA,MAAME,YAAY,SAASd,MAAM,CAAC;EAChCe,WAAWA,CAAA,EAAc;IAAA,IAAbC,MAAM,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;IACrB,KAAK,CAACD,MAAM,CAAC;EACf;;EAEA;AACF;AACA;EACEI,mBAAmBA,CAAA,EAAG;IACpB,MAAMC,QAAQ,GAAG,IAAI,CAACC,kBAAkB;IACxCD,QAAQ,CAACE,OAAO,GAAGF,QAAQ,CAACE,OAAO,IAAI,CAAC,CAAC;;IAEzC;IACA,MAAMC,GAAG,GAAG;MACVC,cAAc,EAAE;QACdC,IAAI,EAAEL,QAAQ,CAACK,IAAI,IAAI,SAAS;QAChCH,OAAO,EAAE;UACPI,QAAQ,EAAEN,QAAQ,CAACM,QAAQ,IAAIN,QAAQ,CAACO,IAAI;UAC5CC,QAAQ,EAAER,QAAQ,CAACQ,QAAQ;UAC3BC,MAAM,EAAET,QAAQ,CAACS,MAAM;UACvBC,KAAK,EAAEV,QAAQ,CAACU,KAAK;UACrBC,QAAQ,EAAEX,QAAQ,CAACW,QAAQ;UAC3BC,YAAY,EAAEZ,QAAQ,CAACY,YAAY;UACnCC,QAAQ,EAAEb,QAAQ,CAACa,QAAQ;UAC3BC,WAAW,EAAEd,QAAQ,CAACc;QACxB;MACF,CAAC;MACDC,MAAM,EAAEf,QAAQ,CAACe,MAAM,IAAIf,QAAQ,CAACgB,IAAI;MACxCd,OAAO,EAAE;QACPe,QAAQ,EAAEjB,QAAQ,CAACiB,QAAQ;QAC3BC,OAAO,EAAElB,QAAQ,CAACkB,OAAO,IAAI,KAAK;QAClCC,IAAI,EAAEnB,QAAQ,CAACmB,IAAI,IAAI,IAAI;QAC3BC,cAAc,EAAEpB,QAAQ,CAACqB,iBAAiB,IAAIrB,QAAQ,CAACsB,OAAO,IAAI,KAAK;QACvEC,cAAc,EAAE,CAAC7C,KAAK,CAACsB,QAAQ,CAACuB,cAAc,CAAC,GAC3CvB,QAAQ,CAACuB,cAAc,GACvB,KAAK;QACTC,mBAAmB,EAAE,KAAK;QAC1BC,gCAAgC,EAAE,KAAK;QACvCC,cAAc,EAAE,KAAK;QACrBC,UAAU,EAAE3B,QAAQ,CAACE,OAAO,CAACyB,UAAU,IAAI,KAAK;QAChDC,OAAO,EAAE5B,QAAQ,CAACE,OAAO,CAAC0B,OAAO,IAAI,MAAM;QAC3CC,sBAAsB,EAAE,KAAK;QAC7B,GAAG7B,QAAQ,CAACE;MACd;IACF,CAAC;;IAED;IACA,IAAIC,GAAG,CAACD,OAAO,CAAC4B,YAAY,EAAE,OAAO3B,GAAG,CAACD,OAAO,CAACiB,IAAI;IAErD,IAAIY,KAAK,CAAC5B,GAAG,CAACD,OAAO,CAACqB,cAAc,CAAC,EAAEpB,GAAG,CAACD,OAAO,CAACqB,cAAc,GAAG,KAAK;IACzE,IAAIpB,GAAG,CAACD,OAAO,CAACqB,cAAc,KAAKS,QAAQ,EAAE7B,GAAG,CAACD,OAAO,CAACqB,cAAc,GAAG,CAAC;IAC3E,IAAIpB,GAAG,CAACD,OAAO,CAACqB,cAAc,GAAG,CAAC,EAAEpB,GAAG,CAACD,OAAO,CAACqB,cAAc,GAAG,CAAC;IAElE,IAAIvB,QAAQ,CAACZ,KAAK,EAAE;MAClBe,GAAG,CAACD,OAAO,CAACd,KAAK,GAAG;QAClB6C,MAAM,EAAE,IAAI;QACZvB,KAAK,EAAE,IAAI;QACXwB,IAAI,EAAE,IAAI;QACVC,OAAO,EAAE;MACX,CAAC;IACH;IAEA,OAAOhC,GAAG;EACZ;EAEAiC,OAAOA,CAAA,EAAG;IACR,MAAMC,GAAG,GAAG5D,OAAO,CAAC,SAAS,CAAC;IAE9B,OAAO4D,GAAG;EACZ;EAEAC,SAASA,CAAA,EAAG;IACV,OAAO,IAAI1D,eAAe,CAAC,IAAI,EAAE,GAAGgB,SAAS,CAAC;EAChD;EAEA2C,WAAWA,CAAA,EAAG;IACZ,OAAO,IAAI1D,WAAW,CAAC,IAAI,EAAE,GAAGe,SAAS,CAAC;EAC5C;EAEA4C,aAAaA,CAAA,EAAG;IACd,OAAO,IAAI1D,aAAa,CAAC,IAAI,EAAE,GAAGc,SAAS,CAAC;EAC9C;EAEA6C,cAAcA,CAAA,EAAG;IACf,OAAO,IAAI1D,cAAc,CAAC,IAAI,EAAE,GAAGa,SAAS,CAAC;EAC/C;EAEA8C,aAAaA,CAAA,EAAG;IACd,OAAO,IAAI1D,aAAa,CAAC,IAAI,EAAE,GAAGY,SAAS,CAAC;EAC9C;EAEA+C,YAAYA,CAAA,EAAG;IACb,OAAO,IAAI1D,YAAY,CAAC,IAAI,EAAE,GAAGW,SAAS,CAAC;EAC7C;EACAgD,YAAYA,CAAA,EAAG;IACb,MAAMC,CAAC,GAAG,IAAI1D,YAAY,CAAC,IAAI,CAAC;IAChC,OAAO0D,CAAC;EACV;EAEAC,cAAcA,CAAA,EAAG;IACf,OAAO,IAAI5D,cAAc,CAAC,IAAI,EAAE,GAAGU,SAAS,CAAC;EAC/C;EAEAmD,kBAAkBA,CAACC,KAAK,EAAE;IACxB,IAAIA,KAAK,KAAK,GAAG,EAAE;MACjB,OAAO,GAAG;IACZ;IAEA,OAAQ,IAAGA,KAAK,CAACC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAE,GAAE;EAC5C;;EAEA;EACA;EACAC,oBAAoBA,CAAA,EAAG;IACrB,OAAO,IAAIC,OAAO,CAAC,CAACC,QAAQ,EAAEC,QAAQ,KAAK;MACzCjE,KAAK,CAAC,iDAAiD,CAAC;MACxD,MAAMkE,MAAM,GAAG,IAAI,CAAClB,OAAO,CAAC,CAAC;MAC7B,MAAMpC,QAAQ,GAAGuD,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAACzD,mBAAmB,CAAC,CAAC,CAAC;MAE9D,MAAM0D,UAAU,GAAG,IAAIH,MAAM,CAACI,UAAU,CAAC1D,QAAQ,CAAC;MAElDyD,UAAU,CAACE,OAAO,CAAEC,GAAG,IAAK;QAC1B,IAAIA,GAAG,EAAE;UACPxE,KAAK,CAAC,+BAA+B,EAAEwE,GAAG,CAACC,OAAO,CAAC;UACnD,OAAOR,QAAQ,CAACO,GAAG,CAAC;QACtB;QAEAxE,KAAK,CAAC,yCAAyC,CAAC;QAEhDqE,UAAU,CAACK,SAAS,GAAG,IAAI;QAC3BL,UAAU,CAACM,EAAE,CAAC,OAAO,EAAGC,CAAC,IAAK;UAC5B5E,KAAK,CAAC,8BAA8B,EAAE4E,CAAC,CAACH,OAAO,CAAC;UAChDJ,UAAU,CAACQ,gBAAgB,GAAGD,CAAC;UAC/BP,UAAU,CAACK,SAAS,GAAG,KAAK;QAC9B,CAAC,CAAC;QAEFL,UAAU,CAACS,IAAI,CAAC,KAAK,EAAE,MAAM;UAC3BT,UAAU,CAACK,SAAS,GAAG,KAAK;UAC5BL,UAAU,CAACQ,gBAAgB,GAAG,sCAAsC;UACpE7E,KAAK,CAAC,mCAAmC,CAAC;QAC5C,CAAC,CAAC;QAEF,OAAOgE,QAAQ,CAACK,UAAU,CAAC;MAC7B,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAU,kBAAkBA,CAACV,UAAU,EAAE;IAC7B,OAAOA,UAAU,IAAIA,UAAU,CAACK,SAAS;EAC3C;;EAEA;EACA;EACAM,oBAAoBA,CAACX,UAAU,EAAE;IAC/BrE,KAAK,CAAC,qBAAqB,CAAC;IAE5B,OAAO,IAAI+D,OAAO,CAAEkB,OAAO,IAAK;MAC9BZ,UAAU,CAACS,IAAI,CAAC,KAAK,EAAE,MAAM;QAC3BG,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;MAEFZ,UAAU,CAACa,KAAK,CAAC,CAAC;IACpB,CAAC,CAAC;EACJ;;EAEA;EACAC,gBAAgBA,CAACC,GAAG,EAAE;IACpB,IAAIC,aAAa,GAAG,CAAC,CAAC;IACtB,OAAOD,GAAG,CAACvB,OAAO,CAAC,QAAQ,EAAGyB,KAAK,IAAK;MACtC,IAAIA,KAAK,KAAK,KAAK,EAAE;QACnB,OAAO,GAAG;MACZ;MAEAD,aAAa,IAAI,CAAC;MAClB,OAAQ,KAAIA,aAAc,EAAC;IAC7B,CAAC,CAAC;EACJ;EAEAE,MAAMA,CAAClB,UAAU,EAAE;IACjB,IAAIA,UAAU,CAACmB,KAAK,CAACC,IAAI,KAAK,UAAU,EAAE;MACxC,MAAMC,WAAW,GAAG,IAAI,CAACC,YAAY,CAACC,GAAG,CAAC,CAAC;MAC3C,IAAIF,WAAW,EAAE;QACf1F,KAAK,CACH,qDAAqD,EACrD,IAAI,CAAC2F,YAAY,CAAClF,MACpB,CAAC;QAED4D,UAAU,CAACwB,OAAO,CAACH,WAAW,CAAC;MACjC;IACF;EACF;EAEAI,eAAeA,CAACC,OAAO,EAAE1B,UAAU,EAAE;IACnC,IAAI,CAACsB,YAAY,CAACK,IAAI,CAACD,OAAO,CAAC;IAC/B,IAAI,CAACR,MAAM,CAAClB,UAAU,CAAC;EACzB;EAEA4B,YAAYA,CAACC,KAAK,EAAEC,QAAQ,EAAE;IAC5B,MAAMjC,MAAM,GAAG,IAAI,CAAClB,OAAO,CAAC,CAAC;IAC7B,MAAMoC,GAAG,GAAG,OAAOc,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAGA,KAAK,CAACd,GAAG;IACzD,IAAIgB,QAAQ,GAAG,CAAC;IAEhB,IAAI,CAAChB,GAAG,EAAE,MAAM,IAAIiB,KAAK,CAAC,oBAAoB,CAAC;IAE/CrG,KAAK,CAAC,yBAAyB,EAAEoF,GAAG,CAAC;IAErC,MAAMW,OAAO,GAAG,IAAI7B,MAAM,CAACoC,OAAO,CAAClB,GAAG,EAAE,CAACZ,GAAG,EAAE+B,cAAc,KAAK;MAC/D,IAAI/B,GAAG,EAAE;QACPxE,KAAK,CAAC,2BAA2B,EAAEwE,GAAG,CAACC,OAAO,CAAC;QAC/C,OAAO0B,QAAQ,CAAC3B,GAAG,CAAC;MACtB;MAEA4B,QAAQ,GAAGG,cAAc;MACzBvG,KAAK,CAAC,+BAA+B,EAAEoG,QAAQ,CAAC;IAClD,CAAC,CAAC;IAEFL,OAAO,CAACpB,EAAE,CAAC,UAAU,EAAE,MAAM;MAC3B3E,KAAK,CAAC,8BAA8B,EAAE,IAAI,CAACwG,EAAE,CAAC;IAChD,CAAC,CAAC;IAEFT,OAAO,CAACpB,EAAE,CAAC,MAAM,EAAE,CAACyB,QAAQ,EAAEK,IAAI,KAAK;MACrCzG,KAAK,CAAC,mCAAmC,EAAEoG,QAAQ,EAAEK,IAAI,CAAC;IAC5D,CAAC,CAAC;IAEFV,OAAO,CAACpB,EAAE,CAAC,UAAU,EAAE,CAACyB,QAAQ,EAAEK,IAAI,KAAK;MACzCzG,KAAK,CACH,6CAA6C,EAC7C+F,OAAO,CAACS,EAAE,EACVJ,QAAQ,EACRK,IACF,CAAC;IACH,CAAC,CAAC;IAEFV,OAAO,CAACpB,EAAE,CAAC,YAAY,EAAE,CAACyB,QAAQ,EAAEK,IAAI,KAAK;MAC3CzG,KAAK,CACH,+CAA+C,EAC/C+F,OAAO,CAACS,EAAE,EACVJ,QAAQ,EACRK,IACF,CAAC;IACH,CAAC,CAAC;IAEFV,OAAO,CAACjB,IAAI,CAAC,kBAAkB,EAAE,MAAM;MACrC9E,KAAK,CAAC,0BAA0B,EAAE+F,OAAO,CAACS,EAAE,CAAC;MAC7C,OAAOL,QAAQ,CAAC,IAAI,EAAEC,QAAQ,CAAC;IACjC,CAAC,CAAC;IAEFL,OAAO,CAACpB,EAAE,CAAC,OAAO,EAAGH,GAAG,IAAK;MAC3BxE,KAAK,CAAC,iCAAiC,EAAE+F,OAAO,CAACS,EAAE,EAAEhC,GAAG,CAACC,OAAO,CAAC;MACjE,OAAO0B,QAAQ,CAAC3B,GAAG,CAAC;IACtB,CAAC,CAAC;IAEF,OAAOuB,OAAO;EAChB;;EAEA;EACA;EACAW,OAAOA,CAACrC,UAAU,EAAE6B,KAAK,EAAE,qCAAsCS,MAAM,EAAE;IACvE,OAAO,IAAI5C,OAAO,CAAC,CAACkB,OAAO,EAAE2B,MAAM,KAAK;MACtC,MAAMb,OAAO,GAAG,IAAI,CAACE,YAAY,CAACC,KAAK,EAAG1B,GAAG,IAAK;QAChD,IAAIA,GAAG,EAAE;UACPmC,MAAM,CAACE,IAAI,CAAC,OAAO,EAAErC,GAAG,CAAC;UACzB,OAAOoC,MAAM,CAACpC,GAAG,CAAC;QACpB;QAEAS,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;MAEFc,OAAO,CAACpB,EAAE,CAAC,KAAK,EAAGmC,GAAG,IAAK;QACzBH,MAAM,CAACI,KAAK,CACVD,GAAG,CAACE,MAAM,CACR,CAACC,IAAI,EAAEC,IAAI,MAAM;UACf,GAAGD,IAAI;UACP,CAACC,IAAI,CAACC,QAAQ,CAACC,OAAO,GAAGF,IAAI,CAACtD;QAChC,CAAC,CAAC,EACF,CAAC,CACH,CACF,CAAC;MACH,CAAC,CAAC;MACFmC,OAAO,CAACpB,EAAE,CAAC,OAAO,EAAGH,GAAG,IAAK;QAC3BmC,MAAM,CAACE,IAAI,CAAC,OAAO,EAAErC,GAAG,CAAC;QACzBoC,MAAM,CAACpC,GAAG,CAAC;MACb,CAAC,CAAC;MACFuB,OAAO,CAACjB,IAAI,CAAC,kBAAkB,EAAE,MAAM;QACrC6B,MAAM,CAACU,GAAG,CAAC,CAAC;QACZpC,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;MAEF,IAAI,CAACqC,eAAe,CAACvB,OAAO,EAAEG,KAAK,CAACqB,QAAQ,CAAC;MAC7C,IAAI,CAACzB,eAAe,CAACC,OAAO,EAAE1B,UAAU,CAAC;IAC3C,CAAC,CAAC;EACJ;EAEAiD,eAAeA,CAACvB,OAAO,EAAEwB,QAAQ,EAAE;IACjC,IAAIC,KAAK,CAACC,OAAO,CAACF,QAAQ,CAAC,EAAE;MAC3B,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,QAAQ,CAAC9G,MAAM,EAAEiH,CAAC,EAAE,EAAE;QACxC,MAAMC,OAAO,GAAGJ,QAAQ,CAACG,CAAC,CAAC;QAC3B,IAAI,CAACE,YAAY,CAAC7B,OAAO,EAAE2B,CAAC,EAAEC,OAAO,CAAC;MACxC;IACF;EACF;EAEAE,gBAAgBA,CAACF,OAAO,EAAE;IACxB,IAAIA,OAAO,GAAG,CAAC,KAAK,CAAC,EAAE;MACrB,MAAM,IAAItB,KAAK,CAAE,qBAAoBsB,OAAQ,4BAA2B,CAAC;IAC3E;IAEA,OAAO;MAAEG,KAAK,EAAE;IAAG,CAAC;EACtB;EAEAC,eAAeA,CAACJ,OAAO,EAAE;IACvB,MAAMzD,MAAM,GAAG,IAAI,CAAClB,OAAO,CAAC,CAAC;IAE7B,IACE,IAAI,CAACnC,kBAAkB,CAACC,OAAO,IAC/B,IAAI,CAACD,kBAAkB,CAACC,OAAO,CAACkH,UAAU,EAC1C;MACA,MAAMC,MAAM,GAAG,IAAI,CAACpH,kBAAkB,CAACC,OAAO,CAACkH,UAAU,CAACL,OAAO,CAAC;MAClE,IAAIM,MAAM,EAAE;QACV,OAAO,CAACA,MAAM,CAACrE,KAAK,EAAEqE,MAAM,CAAChH,IAAI,CAAC;MACpC;IACF;IAEA,QAAQ,OAAO0G,OAAO;MACpB,KAAK,QAAQ;QACX,OAAO,CAACA,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACC,QAAQ,CAAC;MACzC,KAAK,SAAS;QACZ,OAAO,CAACR,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACE,GAAG,CAAC;MACpC,KAAK,QAAQ;QAAE;UACb,IAAIT,OAAO,GAAG,CAAC,KAAK,CAAC,EAAE;YACrB,OAAO,CAACA,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACG,KAAK,CAAC;UACtC;UAEA,IAAIV,OAAO,GAAG1H,QAAQ,CAACC,GAAG,IAAIyH,OAAO,GAAG1H,QAAQ,CAACE,GAAG,EAAE;YACpD,IAAIwH,OAAO,GAAGvH,eAAe,CAACF,GAAG,IAAIyH,OAAO,GAAGvH,eAAe,CAACD,GAAG,EAAE;cAClE,MAAM,IAAIkG,KAAK,CACZ,gEAA+DsB,OAAQ,EAC1E,CAAC;YACH;YAEA,OAAO,CAACA,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACI,MAAM,CAAC;UACvC;UAEA,OAAO,CAACX,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACK,GAAG,CAAC;QACpC;MACA;QAAS;UACP,IAAIZ,OAAO,YAAYa,IAAI,EAAE;YAC3B,OAAO,CAACb,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACO,QAAQ,CAAC;UACzC;UAEA,IAAId,OAAO,YAAYe,MAAM,EAAE;YAC7B,OAAO,CAACf,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACS,SAAS,CAAC;UAC1C;UAEA,OAAO,CAAChB,OAAO,EAAEzD,MAAM,CAACgE,KAAK,CAACC,QAAQ,CAAC;QACzC;IACF;EACF;;EAEA;EACA;EACAS,MAAMA,CAACvE,UAAU,EAAE6B,KAAK,EAAE;IACxB,OAAO,IAAInC,OAAO,CAAC,CAACkB,OAAO,EAAE2B,MAAM,KAAK;MACtC,MAAMiC,IAAI,GAAG,EAAE;MACf,MAAM9C,OAAO,GAAG,IAAI,CAACE,YAAY,CAACC,KAAK,EAAE,CAAC1B,GAAG,EAAEsE,KAAK,KAAK;QACvD,IAAItE,GAAG,EAAE;UACP,OAAOoC,MAAM,CAACpC,GAAG,CAAC;QACpB;QAEA0B,KAAK,CAAC6C,QAAQ,GAAGF,IAAI;QAErBG,OAAO,CAACC,QAAQ,CAAC,MAAM,IAAI,CAAC1D,MAAM,CAAClB,UAAU,CAAC,CAAC;QAE/CY,OAAO,CAACiB,KAAK,CAAC;MAChB,CAAC,CAAC;MAEFH,OAAO,CAACpB,EAAE,CAAC,KAAK,EAAGmC,GAAG,IAAK;QACzB9G,KAAK,CAAC,cAAc,CAAC;QACrB6I,IAAI,CAAC7C,IAAI,CAACc,GAAG,CAAC;MAChB,CAAC,CAAC;MAEF,IAAI,CAACQ,eAAe,CAACvB,OAAO,EAAEG,KAAK,CAACqB,QAAQ,CAAC;MAC7C,IAAI,CAACzB,eAAe,CAACC,OAAO,EAAE1B,UAAU,CAAC;IAC3C,CAAC,CAAC;EACJ;;EAEA;EACAuD,YAAYA,CAACsB,GAAG,EAAExB,CAAC,EAAEyB,YAAY,EAAE;IACjC,MAAM,CAACxB,OAAO,EAAEyB,WAAW,CAAC,GAAG,IAAI,CAACrB,eAAe,CAACoB,YAAY,CAAC;IACjE,MAAME,WAAW,GAAG,GAAG,CAACC,MAAM,CAAC5B,CAAC,CAAC;IACjC,IAAI5G,OAAO;IAEX,IAAI,OAAO6G,OAAO,KAAK,QAAQ,IAAIA,OAAO,GAAG,CAAC,KAAK,CAAC,EAAE;MACpD7G,OAAO,GAAG,IAAI,CAAC+G,gBAAgB,CAACF,OAAO,CAAC;IAC1C;IAEA3H,KAAK,CACH,0CAA0C,EAC1C0H,CAAC,EACD0B,WAAW,CAAC3D,IAAI,EAChBkC,OACF,CAAC;IAED,IAAIe,MAAM,CAACa,QAAQ,CAAC5B,OAAO,CAAC,EAAE;MAC5B7G,OAAO,GAAG;QACRL,MAAM,EAAE;MACV,CAAC;IACH;IAEAyI,GAAG,CAACM,YAAY,CAACH,WAAW,EAAED,WAAW,EAAEzB,OAAO,EAAE7G,OAAO,CAAC;EAC9D;;EAEA;EACA2I,eAAeA,CAACvD,KAAK,EAAEwD,MAAM,EAAE;IAC7B,IAAIxD,KAAK,IAAI,IAAI,EAAE;IACnB,IAAI;MAAE6C;IAAS,CAAC,GAAG7C,KAAK;IACxB,MAAM;MAAEyD;IAAO,CAAC,GAAGzD,KAAK;IAExB,IAAIA,KAAK,CAAC0D,MAAM,EAAE;MAChB,OAAO1D,KAAK,CAAC0D,MAAM,CAACC,IAAI,CAACH,MAAM,EAAEX,QAAQ,CAAC;IAC5C;IAEAA,QAAQ,GAAGA,QAAQ,CAAC3J,GAAG,CAAE0H,GAAG,IAC1BA,GAAG,CAACE,MAAM,CAAC,CAAC8C,OAAO,EAAEC,CAAC,KAAK;MACzB,MAAM3C,OAAO,GAAG2C,CAAC,CAAC5C,QAAQ,CAACC,OAAO;MAElC,IAAI0C,OAAO,CAAC1C,OAAO,CAAC,EAAE;QACpB,IAAI,CAACI,KAAK,CAACC,OAAO,CAACqC,OAAO,CAAC1C,OAAO,CAAC,CAAC,EAAE;UACpC0C,OAAO,CAAC1C,OAAO,CAAC,GAAG,CAAC0C,OAAO,CAAC1C,OAAO,CAAC,CAAC;QACvC;QAEA0C,OAAO,CAAC1C,OAAO,CAAC,CAACpB,IAAI,CAAC+D,CAAC,CAACnG,KAAK,CAAC;MAChC,CAAC,MAAM;QACLkG,OAAO,CAAC1C,OAAO,CAAC,GAAG2C,CAAC,CAACnG,KAAK;MAC5B;MAEA,OAAOkG,OAAO;IAChB,CAAC,EAAE,CAAC,CAAC,CACP,CAAC;IAED,IAAI5D,KAAK,CAAC0D,MAAM,EAAE,OAAO1D,KAAK,CAAC0D,MAAM,CAACC,IAAI,CAACH,MAAM,EAAEX,QAAQ,CAAC;IAC5D,QAAQY,MAAM;MACZ,KAAK,QAAQ;QACX,OAAOZ,QAAQ;MACjB,KAAK,OAAO;QACV,OAAOA,QAAQ,CAAC,CAAC,CAAC;MACpB,KAAK,OAAO;QACV,OAAO3J,GAAG,CAAC2J,QAAQ,EAAE7C,KAAK,CAAC8D,KAAK,CAAC;MACnC,KAAK,QAAQ;MACb,KAAK,KAAK;MACV,KAAK,QAAQ;MACb,KAAK,SAAS;QACZ,IAAI9D,KAAK,CAAC+D,SAAS,EAAE;UACnB,IAAI/D,KAAK,CAAC+D,SAAS,KAAK,YAAY,EAAE;YACpC,OAAOlB,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;UACxB;QACF;QACA,OAAOA,QAAQ;MACjB;QACE,OAAOA,QAAQ;IACnB;EACF;AACF;AAEA5E,MAAM,CAACC,MAAM,CAAC/D,YAAY,CAAC6J,SAAS,EAAE;EACpCvE,YAAY,EAAE,EAAE;EAEhBwE,OAAO,EAAE,OAAO;EAEhBC,UAAU,EAAE;AACd,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAGjK,YAAY"},"metadata":{},"sourceType":"script","externalDependencies":[]}